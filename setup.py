#!/usr/bin/env python

import json
import os
from datetime import datetime, timezone

from setuptools import setup, find_namespace_packages
from setuptools.command.install import install


class InstallCommand(install):
    user_options = install.user_options + [
        ('wazuh-version=', None, 'Wazuh Version'),
        ('install-type=', None, 'Installation type: server, local, hybrid')
    ]

    def initialize_options(self):
        install.initialize_options(self)
        self.wazuh_version = None
        self.install_type = None

    def finalize_options(self):
        install.finalize_options(self)

    def run(self):
        here = os.path.abspath(os.path.dirname(__file__))
        with open(os.path.join(here, 'wazuh', 'core', 'wazuh.json'), 'w') as f:
            json.dump({'install_type': self.install_type,
                       'wazuh_version': self.wazuh_version,
                       'installation_date': datetime.utcnow().replace(tzinfo=timezone.utc).strftime(
                           '%a %b %d %H:%M:%S UTC %Y')
                       }, f)

        install.do_egg_install(self)
